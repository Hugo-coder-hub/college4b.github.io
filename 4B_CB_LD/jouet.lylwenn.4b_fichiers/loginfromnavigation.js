define('app/core/navigation/loginfromnavigation',["require","exports","./navigationclient","../../gen/service/space","../../data/treedata","i18next","i18n!../../../locales:space"],function(e,a,t,n,s){var o;Object.defineProperty(a,"__esModule",{value:!0}),a.loginfromnavigation=void 0,a=a.loginfromnavigation={},o=e("i18next"),a.LoginFromNavigation=class{get sandbox(){if(this._sandbox)return this._sandbox;throw new Error("Sandbox is not set")}set sandbox(e){this._sandbox=e}activate(e,a){this.sandbox.getSpaceRightManager().isSpaceghostAdminUser()&&t.navigation.getManager(this.sandbox).listenToNavEvent(e=>{this.onNavigate(e)})}onNavigate(a){var e=a.nav.data.tree,t=e?e.id:null;e&&s.TreeData.isRootOfAUser(e)&&t!=this.previousTreeId&&(e=a.nav.data.tree.asso.rootAssoOfUserId)!==this.sandbox.getUserId()&&n.space.canLoginFromNavigation(this.sandbox,e,e=>{e&&this.showConnectPanel(a.nav.data.tree.asso.rootAssoOfUserId,a.nav.data.tree.title,a.nav.data.currentUser)},()=>{}),this.previousTreeId=t}showConnectPanel(e,a,t){t={type:0,onClickCancel:()=>{},onClickProceed:()=>{this.relogUserAndNavigate(e)},proceedTitle:o.t("space:admin_session.login_proceed"),title:o.t("space:admin_session.login_title",{currentname:t.userName,username:a})};this.sandbox.getModuleManager().startModule(4260,t)}relogUserAndNavigate(e){n.space.loginAs(this.sandbox,e,()=>{window.location.reload()},()=>{})}deactivate(){}}});
