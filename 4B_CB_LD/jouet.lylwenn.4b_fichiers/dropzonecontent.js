define('app/squareworld/dropzone/dropzoneinteractionmanager',["require","exports","./dropzonecontent","../tree/interaction/drageditinteractor","../tree/interaction/draginteractorbase","app/util/animation/animation","app/squareworld/tree/interaction/neighbourmover","./dropzoneconstant","../tree/interaction/splitparagraphinteractor","../tree/interaction/multipledragmanager"],function(e,t,a,n,r,o,i,s,l,g){Object.defineProperty(t,"__esModule",{value:!0}),t.dropzoneContent=void 0;{t=t.dropzoneContent={};let r;class p extends n.treeWorld.DragEditInteractor{constructor(e){super(e,e.isAnonymousMode()),this.pearlHasBeenDropInto=!1,r=a.dropzoneContent.DROPZONE_CONTAINER,this.debugName="DropzoneInteractionManager2"}initDropInteractorsForDragManager(e,r){this.neighbourMover=new i.treeWorld.NeighbourMover(this),this.multipleDragManager=new g.multipleDragManager.MultipleDragManager(this,g.OriginInteractorType.Dropzone),this.isAnonymous||(this.removeSectionInteractor=new l.treeWorld.RemoveSectionInteractor(this.sandbox,this,r))}onDelegateDropInInternalZone(e,r,t,a){e.isOverTrash||(this.setPearlHasBeenDragInto(!0),super.onDelegateDropInInternalZone(e,r,t,a),e.$el.css({transform:""}))}onDelegateDropFromExternalZone(e,r,t,a,n,o){e.isOverTrash||(this.setPearlHasBeenDragInto(!0),super.onDelegateDropFromExternalZone(e,r,t,a,n,o)),this.setPearlHasBeenDragInto(!0)}onDelegateCopyFromExternalZone(e,r,t,a){this.isAnonymous&&this.sandbox.getEventBus().publish(13,6),this.setPearlHasBeenDragInto(!0),super.onDelegateCopyFromExternalZone(e,r,t,a)}movePearlToDragLayer(e){this.changePearlLayer(e,this.getMainGridSelector(),r,!0),super.movePearlToDragLayer(e)}movePearlToOriginalLayer(e){this.currentDropManager&&this.currentDropManager!=this&&this.currentDropManager.preventBackToLayer()||this.isBackToLayerPostponed||(super.movePearlToOriginalLayer(e),this.changePearlLayer(e,r,this.getMainGridSelector(),!1))}getLayouter(){return super.getLayouter()}getClosestSquarePosition(e,r,t){if(20!==this.interactionZone)return this.getLayouter().getDefaultSquarePosition();let a=super.getClosestSquarePosition(e,r);var n;return t&&(n=this.getLayouter().getDropzoneScrollingNode().getCurrentScroll(),-1==(a=super.getClosestSquarePosition(e+n,r)).collectionIndex&&(a.collectionIndex=0,this.collection.showDropzoneMessage(),t.model.isDocked)&&(a.collectionIndex=this.collection.size()-t.model.index),a),a}setNormalPearlStyle(e,r){let t;for(var a of this.externalInteractors)if(a.collection){t=a.getNormalPearlWidth();break}void 0===t&&(this.sandbox.logger.assert(!1,"no external interaction manager, no normal pearlWidth !!!"),t=s.dropzoneConstant.PEARL_WIDTH);var n=t/e.getUiPearl().width(),n={left:-e.dragOffsetX*(n-1)+"px",top:-e.dragOffsetY*(n-1)+"px",width:t+"px",height:t+"px"},o=Object.assign(Object.assign({},n),{transform:"translate(4px,4px)"}),i=Object.assign(Object.assign({},n),{transform:"translate(0px, 0px)"});this.applyCssToDraggedPearls(r,e,[n,o,i],!1)}setSmallPearlStyle(e,r){var t=s.dropzoneConstant.PEARL_WIDTH,t={left:"4px",top:"4px",width:t+"px",height:t+"px"},a=Object.assign(Object.assign({},t),{transform:"translate(-4px,-4px)"});this.applyCssToDraggedPearls(r,e,[t,a,a],!0)}applyCssToDraggedPearls(t,e,a,r){var n=e.$el.find(".following-pearls").find(".uipearl").first(),o=e.$el.find(".following-pearls").find(".uipearl").slice(1),e=(t&&(t.addElement(e.getUiPearl(),a[0],!0),0<n.length&&t.addElement(n,a[1],!0),o.each((e,r)=>{t.addElement($(r),a[2],!0)})),[e.$el,n,o]);e.forEach(r?e=>e.addClass("dropzone-uipearl-element"):e=>e.removeClass("dropzone-uipearl-element"))}isOverTrash(e,r,t){return this.isDraggedPearlOverTrash(e,r,t)}convertWindowToGrid(e,r){var t=$(this.getContainerSelectorInternal()).offset();return{x:e-(t=t||{left:0,top:0}).left,y:r-t.top}}isInInteractorZone(e,r){return this.collection.isUserLogged()?(e=this.convertWindowToGrid(e,r)).y>-s.dropzoneConstant.INTERACTION_TOP_MARGIN&&-215<=e.x?20:10:0}getInteractorPriority(){return 2}cancelDrag(){(this.currentDropManager=this).movePearlToOriginalLayer(this.draggedView),this.draggedView.setIsOverTrash(!1),this.draggedView.launchAnimationOverTrash(!1),this.setDraggedPearlIsHandled(!1),this.resetDragDraggedPearlState(this.draggedView);var e=o.animation.createParallelTween(.3);this.setSmallPearlStyle(this.draggedView,e),this.isDraggingMultiple()&&this.multipleDragManager.onDrop(),this.collection.requestLayout()}getContainerSelectorInternal(){return $(r).is(":visible")?r:".dropzone-message"}getContainerSelector(){return r}getInteractorStyle(){return 1}leaveDropManager(){super.leaveDropManager(),this.collection.hideDropzoneMessage()}deleteDraggedPearl(e,r){this.setPearlHasBeenDragInto(!0),super.deleteDraggedPearl(e,r)}applyCustomExternalDropPositionningRules(e){return 0!=e.collectionIndex&&-1!=e.collectionIndex||(e.collectionIndex=0,this.collection.requestResetScroll()),e}applyCustomRulesIfCollectionIsEmpty(){this.getContainerSelectorInternal()!=r&&($(this.getContainerSelectorInternal()).hide(),$(r).show(),$("#dropzone-main-container").css({overflow:"visible"}))}setPearlHasBeenDragInto(e){this.pearlHasBeenDropInto=e}isDropzone(){return!0}onDragDelegatePearlStart(e,r,t){e.fromDropzone=!0,super.onDragDelegatePearlStart(e,r,t)}}t.DropzoneInteractionManager=p}});

define('text!app/squareworld/dropzone/dropzonecontent.html',[],function () { return '<script type="text/template">\r\n    <div class="dropzone-message" style="display: none">\r\n    </div>\r\n    <div class="scrolling-node">\r\n    </div>\r\n</script>\r\n';});

define('app/squareworld/dropzone/dropzonecontent',["require","exports","app/core/navigation/navigationclient","app/core/navigation/description","app/data/pearldata","app/data/treeinfodata","./dropzoneinteractionmanager","./dropzoneconstant","app/squareworld/square/square","app/squareworld/tree/treesquarefactory","app/squareworld/squareworldgrid","app/squareworld/tree/treepearlcollection","app/squareworld/square/squareanimation","app/util/animation/animation","app/data/userdata","app/ui/settings/sidebarfacade","marionette","text!./dropzonecontent.html","css!./dropzonecontent.css","browserdetect"],function(e,t,r,i,n,o,s,a,l,d,h,c,u,g,p,m){Object.defineProperty(t,"__esModule",{value:!0}),t.dropzoneContent=void 0;{var S=t.dropzoneContent={DROPZONE_CONTAINER:".scrolling-node",REQUEST_RESET_SCROLL_EVENT:"reset-scroll-dz"};let i=e("i18next");var z=e("text!./dropzonecontent.html");S.DropZoneComponent=class{constructor(){this.startWithNavigation=!1}get sandbox(){if(this._sandbox)return this._sandbox;throw new Error("Sandbox is not set")}set sandbox(e){this._sandbox=e}activate(e,t){this.navManager=r.navigation.getManager(this.sandbox),t&&(this.region=Marionette.Region.buildRegion(t,Marionette.Region)),this.loadDropZone(),this.navManager.listenToNavEvent(e=>this.onNavigate(e.nav)),this.sandbox.getEventBus().subscribeTo(19,5,()=>this.refreshDropZone(),this),this.sandbox.logger,this.handleFirefoxWin32bits()}loadDropZone(){this.navManager.getCurrentLocation(e=>{this.sandbox.isAnonymousMode(),this.loadDropZoneFromCurrentUser(e),this.sandbox.getEventBus().subscribeTo(5,3,this.onResize,this),m.sidebarfacade.subscribeToSidebarDidChange(this.sandbox,this,e=>{1!==e.toState&&1!==e.fromState||this.onResize(!e.noAnimation)})},!0)}refreshDropZone(){this.navManager.refreshDropzone(e=>{this.loadDropZoneFromCurrentUser(e)})}makeAnonymousDropzoneTree(){return{id:-1,pearls:[{contentType:4}],title:"anonymousDZ"}}loadDropZoneFromCurrentUser(e){var t=p.UserData.getUserData(e.data.currentUser).dropzoneTree,t=(1<(t=this.sandbox.isAnonymousMode()?this.makeAnonymousDropzoneTree():t).pearls.length&&this.showArrows(),this.dropzoneScrollingNode=new P(this.sandbox,t,this),this.initClickListeners(),this.startWithNavigation=!1,e.data?o.TreeInfoData.getTreeInfoData(e.data.info):null);this.isHome=t&&t.getIsCurrentUserOwner(),this.region.close(),this.region.show(this.dropzoneScrollingNode),this.dropzoneScrollingNode.requireLayout(!1,!1)}deactivate(){this.region.close()}getWidth(){return this.region.$el.width()}onResize(e){this.dropzoneScrollingNode.onResize(e)}onNavigate(e){if(this.dropzoneScrollingNode)switch(e.description.navType){case 9:case 2:case 3:case 7:case 8:case 10:case 15:this.isHome=!1;break;default:var t=o.TreeInfoData.getTreeInfoData(e.data.info);this.isHome=!!t&&t.getIsCurrentUserOwner()}else this.startWithNavigation=!0}initClickListeners(){$("#dropzone-left-arrow-button").click(()=>{this.dropzoneScrollingNode.scrollByPage(1)}).mousedown(()=>{this.dropzoneScrollingNode.scrollByPage(1),this.dropzoneScrollingNode.continuousScroll=!0}).mouseup(()=>{this.dropzoneScrollingNode.continuousScroll=!1}).mouseout(()=>{this.dropzoneScrollingNode.continuousScroll=!1}),$("#dropzone-right-arrow-button").mousedown(()=>{this.dropzoneScrollingNode.scrollByPage(-1),this.dropzoneScrollingNode.continuousScroll=!0}).mouseup(()=>{this.dropzoneScrollingNode.continuousScroll=!1}).click(()=>{this.dropzoneScrollingNode.scrollByPage(-1)}).mouseout(()=>{this.dropzoneScrollingNode.continuousScroll=!1});let i=$("#dropzone-main-container");$(document).mousemove(e=>{let t=!1;if(this.sandbox.getEventBus().publish(13,13,e=>{t=t||e}),t)return!1;e.pageY<i.offset().top||e.pageX<i.offset().left||e.pageX>$("#dropzone-main-container").offset().left+i.width()?this.dropzoneScrollingNode.collection.hideDropzoneMessage():this.dropzoneScrollingNode.collection.showDropzoneMessage()})}showArrows(){$(".dropzone-arrow").css("visibility","")}isInExternalAccount(e){this.navManager.getCurrentLocation(e)}handleFirefoxWin32bits(){"Firefox"==BrowserDetect.browser&&32<BrowserDetect.version&&(0!=BrowserDetect.win32Or64||"Linux"==BrowserDetect.OS)&&$("body").toggleClass("no-3d-transform",!0)}};class P extends Marionette.CompositeView{constructor(e,t,i){super({template:z,collection:new y(t,e)}),this.hasAnimation=Modernizr.cssanimations,this.currentScroll=0,this.currentPageIndex=0,this.DROPZONE_SIDE_BUFFER=3,this.isScrolling=!1,this.continuousScroll=!1,this.isAddingElement=!1,this.isManuallyAddingElement=!1,this.isRenderingCollection=!1,this.shouldResetScroll=!1,this.sandbox=e,this.collection.init(this),this.component=i,this.layouter=new I,this.layouter.setGrid(this),this.itemView=l.square.SquareView,this.itemViewContainer=S.DROPZONE_CONTAINER,this.itemViewOptions={className:"uipearl-element dropzone-uipearl-element"};this.listenTo(this.collection,h.squareWorldGrid.REQUEST_LAYOUT_EVENT,(...e)=>{this.refreshDropZone(0<e.length&&e[0].slow)}),this.listenTo(this.collection,S.REQUEST_RESET_SCROLL_EVENT,()=>{this.shouldResetScroll=!0}),this.sandbox.getEventBus().subscribeTo(4,0,e=>this.sendCopyView(e.elementId,e.callback),this),this.initHasItemsInMyCollections(),this.sandbox.getEventBus().subscribeTo(8,0,this.emptyDropzone,this)}buildItemView(e,t,i){return l.square.makeView(e,i)}addItemView(e,t,i){e.disableLayout?e.disableLayout=!1:super.addItemView(e,t,i)}findByCoords(e,t){return this.sandbox.logger.e("Not implemented yet"),null}findByModel(e){return this.children.findByModel(e)}copyView(e){return(e=this.buildItemView(e.model.clone(),this.itemView,this.itemViewOptions)).render(),e.onResize(),e}getLayouter(){return this.layouter}isShowingEmptyView(){return!1}emptyDropzone(){var e=this.collection.tree,t=e.pearls,i=this.findCollectionRootPearlIndex(t,e.rootPearlId);if(0<=i){t.splice(i,1);var o,i=this.collection.getSynchroApi().makeDeletePearl(t,e);this.sandbox.getEventBus().publish(9,8,{pearls:t,tree:e});for(o of this.collection.models)o&&o.setDeletePearl(!0);this.collection.requestLayout(),this.collection.endEditing(i,[e],!1)}}getCurrentScroll(){return this.currentScroll}getCurrentPageIndex(){return this.currentPageIndex}getCurrentVisualWidth(){return this.component.getWidth()}getDropzoneSideBuffer(){return Math.max(this.DROPZONE_SIDE_BUFFER,this.computeNumberOfPearlsOnScreen())}computeNumberOfPearlsOnScreen(){return Math.ceil(this.getCurrentVisualWidth()/(this.layouter.getPearlWidth()+this.layouter.getPearlGap()))}requireLayout(e,t){var i;this.layouter.invalidatePearlsSize(),this.checkCurrentDomElementsInPage(),e?(this.collection.hasPearlBeenDropInto()&&this.hideNonVisibleNodes(),this.sandbox.getGraphicalQueue().postAction(e=>{new u.squareanimation.LayoutAnimation(this,t).startAnimation(()=>{this.onLayoutAnimationEnded(),e()})}),this.collection.hasPearlBeenDropInto()&&(i=this).sandbox.getGraphicalQueue().postInstantAction(()=>{i.resetNodesVisibility()})):(this.layouter.layoutPearls(null),this.resetNodesVisibility())}onResize(e){this.layouter.getpageSize(),this.layouter.invalidatePearlsSize(),this.layouter.getpageSize();this.goToPage(this.currentPageIndex,null!=e?e:0==this.currentPageIndex,!1,!0)}goToPage(e,t,i,o){this.currentPageIndex!=e?(this.currentPageIndex=e,this.currentScroll=0,this.render(),this.$(this.itemViewContainer).addClass(".no-transition"),this.currentScroll=-1*this.currentPageIndex*this.layouter.getPageScrollSize(),this.$(this.itemViewContainer).css("margin-left",this.currentScroll+"px"),this.layouter.layoutPearls(null),this.$(this.itemViewContainer).removeClass(".no-transition")):(o&&(this.currentScroll=-1*this.currentPageIndex*this.layouter.getPageScrollSize(),this.$(this.itemViewContainer).css({"margin-left":this.currentScroll+"px"})),this.requireLayout(t,i))}showPearl(t){var e=_.find(this.collection.models,e=>t===e.data.id),e=$.inArray(e,this.collection.models);this.goToPage(e,!0,!0,!0)}sendCopyView(t,e){var i,o=_.find(this.collection.models,e=>t===e.data.id);o&&(o=this.findByModel(o))&&(i=this.copyView(o),o=o.getAbsolutePosition(),i.model.setContentModel(null),i.model.interactionManager=null,e({transitionalView:i,positionAndSize:o}))}scrollByPage(r){var e=this.layouter.getPageScrollSize(),t=this.collection.size();let n=this.layouter.getpageSize();if(this.currentScroll+r*e>=-1*(t-1)*e-.005&&this.currentScroll+r*e<1&&!this.isScrolling&&(t>=this.layouter.getpageSize()||0!=this.currentPageIndex)){this.isScrolling=!0,this.currentScroll+=r*e,-1<this.currentScroll&&this.currentScroll<1&&(this.currentScroll=0);let i=t-1,o=this;this.hasAnimation?(e=0<r?this.currentPageIndex-1:this.currentPageIndex+n,t=0<r?this.currentPageIndex+n-1:this.currentPageIndex,this.addFadeForModels(e,t,.3),this.$(this.itemViewContainer).animate({marginLeft:this.currentScroll+"px"},200,"linear",function(){var e=0<r?o.getCurrentPageIndex()+(n+o.getDropzoneSideBuffer()):o.getCurrentPageIndex()-(o.getDropzoneSideBuffer()+1),t=0<r?o.getCurrentPageIndex()-o.getDropzoneSideBuffer():o.getCurrentPageIndex()+(n+o.getDropzoneSideBuffer()-1);0<=e&&e<=i&&o.removePage(e),0<=t&&t<=i&&o.addPage(t),o.isScrolling=!1,o.continuousScroll&&o.scrollByPage(r),o.layouter.layoutPearls(null)}),this.currentPageIndex+=-1*r):(this.$(this.itemViewContainer).css({"margin-left":this.currentScroll+"px"}),e=0<r?o.getCurrentPageIndex()+(n+o.getDropzoneSideBuffer()):o.getCurrentPageIndex()-(o.getDropzoneSideBuffer()+1),t=0<r?o.getCurrentPageIndex()-o.getDropzoneSideBuffer():o.getCurrentPageIndex()+(n+o.getDropzoneSideBuffer()-1),0<=e&&e<=i&&o.removePage(e),0<=t&&t<=i&&o.addPage(t),o.layouter.layoutPearls(null),o.isScrolling=!1,o.currentPageIndex+=-1*r,o.continuousScroll&&setTimeout(function(){o.scrollByPage(r)},120))}}refreshDropZone(e){var t=0<this.collection.size()?this.currentPageIndex:0,t=this.shouldResetScroll?0:t;this.shouldResetScroll=!1,t=Math.min(Math.max(0,this.collection.size()-1),Math.max(0,t)),this.goToPage(t,!0,e,!1)}onShow(){this.layouter.layoutPearls(null)}onBeforeItemAdded(){this.isAddingElement=!this.isManuallyAddingElement&&!0}onAfterItemAdded(){this.isAddingElement=!1,this.isManuallyAddingElement=!1}onCollectionBeforeRender(){this.isRenderingCollection=!0}onCollectionRendered(){this.isRenderingCollection=!1}appendHtml(e,t,i){var o,r=this.layouter.getpageSize();this.isAddingElement&&!this.isRenderingCollection?(o=this.collection.size()-i-1)>=this.currentPageIndex-this.getDropzoneSideBuffer()&&o<=this.currentPageIndex+r+this.getDropzoneSideBuffer()&&(t.model.isAddedToDom=!0,super.appendHtml(e,t,i)):i>=this.currentPageIndex-this.getDropzoneSideBuffer()&&i<=this.currentPageIndex+r+this.getDropzoneSideBuffer()&&(t.model.isAddedToDom=!0,super.appendHtml(e,t,i))}showCollection(){var i,o=this.layouter.getpageSize(),r=this;this.collection.each(function(e,t){t>=r.currentPageIndex-r.getDropzoneSideBuffer()&&t<r.currentPageIndex+o+r.getDropzoneSideBuffer()&&(i=this.getItemView(e),this.addItemView(e,i,t))},this)}removePage(e){e=this.collection.at(e);e&&(e.isAddedToDom=!1,this.removeItemView(e))}addPage(e){this.isManuallyAddingElement=!0;var t,i=this.collection.at(e);i&&(t=this.getItemView(i),this.addItemView(i,t,e))}checkCurrentDomElementsInPage(){var e=this.layouter.getpageSize();let o=this,r=o.currentPageIndex-o.getDropzoneSideBuffer(),n=o.currentPageIndex+e+o.getDropzoneSideBuffer();this.collection.each(function(e,t){if(t>=r&&t<n){if(!e.isAddedToDom){if(null!=(i=this.collection.interactionManager.multipleDragManager)&&i.isActivated){var i=this.collection.interactionManager.multipleDragManager.getAllDraggedModels().length;if(t>=n-i)return}o.addPage(t)}}else e.isAddedToDom&&o.removePage(t)},this);var t=new u.squareanimation.AppearAnimation(this);t.slow=!1,setTimeout(function(){o.sandbox.getGraphicalQueue().postAction(e=>{t.startAnimation(e)})},300)}hideNonVisibleNodes(){var t=this.layouter.getpageSize(),i=this.collection.size(),o=this;this.children.each(e=>{(i-e.model.index<o.currentPageIndex||i-e.model.index>=o.currentPageIndex+t)&&e.$el.hide()},null),$("#dropzone-main-container").css({overflow:"visible"})}resetNodesVisibility(){$("#dropzone-main-container").css({overflow:""}),this.children.each(e=>{e.$el.show()},null),this.collection.resetPearlHasBeenDropInto()}addFadeForModels(t,i,e){var o=this.collection.size(),r=g.animation.createParallelTween(e);this.children.each(e=>{o-e.model.index==t&&0<=t?(e.$el.css({opacity:0}),r.addElement(e.$el,{opacity:1}),r.onComplete(()=>{e.$el.css({opacity:""})})):o-e.model.index==i&&0<=i&&(e.$el.css({opacity:1}),r.addElement(e.$el,{opacity:0}),r.onComplete(()=>{e.$el.css({opacity:""})}))},null),r.start()}findCollectionRootPearlIndex(e,t){for(var i=-1,o=0;o<e.length;o++){var r=e[o];n.PearlData.isRoot(r)&&r.id==t&&(i=o)}return i}initHasItemsInMyCollections(){var o;this.hasItemsInMyCollections=$("#related-button").is(":visible"),this.hasItemsInMyCollections||r.navigation.getManager((o=this).sandbox).getCurrentLocation(e=>{var t=e.data.currentUser.rootTreeId,i=o.sandbox.getEventBus().subscribeTo(9,4,e=>{o.hasItemsInMyCollections=e.tree.id==t&&1<e.tree.pearlCount,o.hasItemsInMyCollections&&o.sandbox.getEventBus().stopSubscription(i)},o)})}lastModelIndex(e){return-1}onLayoutAnimationEnded(){}}S.DropZoneScrollingNode=P;class y extends c.TreePearlCollection{constructor(e,t){super(e,t,new s.dropzoneContent.DropzoneInteractionManager(t),new d.treeSquareFactory.TreeSquareFactory(t,e,!0)),void 0!==e&&null!=e&&void 0!==e.pearls?this.isUserLoggedInternal=!0:this.isUserLoggedInternal=!1,this.sort()}hasLazyLoading(){return!1}init(e){this.interactionManager.init(this,e)}isDocked(){return!0}getPearlOrder(){return-1}comparator(e,t){return-1*super.comparator(e,t)}isUserLogged(){return this.isUserLoggedInternal}requestResetScroll(){this.trigger(S.REQUEST_RESET_SCROLL_EVENT)}hasPearlBeenDropInto(){return this.interactionManager.pearlHasBeenDropInto}resetPearlHasBeenDropInto(){this.interactionManager.setPearlHasBeenDragInto(!1)}onTreeUpdate(e,t){super.onTreeUpdate(e,t),e.pearls&&1<e.pearls.length?$(".dropzone-arrow").css("visibility",""):$(".dropzone-arrow").css("visibility","hidden")}showDropzoneMessage(){var e,t;0<this.size()||(t=i.t("bottombar.dropzone.empty"),(e=document.querySelector(".dropzone-message"))instanceof HTMLElement&&(e.innerHTML=t,e.style.display="block"),(t=document.querySelector(".scrolling-node"))instanceof HTMLElement&&(t.style.display="none"))}hideDropzoneMessage(){var e=document.querySelector(".dropzone-message"),e=(e instanceof HTMLElement&&(e.style.display="none"),document.querySelector(".scrolling-node"));e instanceof HTMLElement&&(e.style.display="block")}getVisibleItemNumber(){return 0}updatePearlCountInSubCollection(e){}}S.DropzoneCollection=y;class I{constructor(){this.DZ_PEARL_MARGIN=12,this.DZ_MARGIN_VARIATION=.5,this.DZ_SIDE_MARGIN=8,this.isPearlSizeValid=!1,this.pearlWidth=a.dropzoneConstant.PEARL_WIDTH+8,this.pearlMargin=12}getDropzoneScrollingNode(){return this.dropzoneScrollingNode}setGrid(e){this.dropzoneScrollingNode=e}getPearlWidth(){return this.pearlWidth}getPearlGap(){return this.pearlMargin}computePearlsMeasures(){var e,t,i;this.isPearlSizeValid||(e=this.dropzoneScrollingNode.getCurrentVisualWidth(),t=this.dropzoneScrollingNode.getCurrentVisualWidth()-2*this.DZ_SIDE_MARGIN+1,this.pageSize=Math.floor(t/(this.pearlWidth+this.DZ_PEARL_MARGIN*(1-this.DZ_MARGIN_VARIATION))),i=this.DZ_MARGIN_VARIATION,this.pearlMargin=Math.min(this.DZ_PEARL_MARGIN*(1+i),Math.max((t-this.pageSize*this.pearlWidth)/(this.pageSize-1),this.DZ_PEARL_MARGIN*(1-i))),this.pageSize<=6&&0<Math.abs(e-this.pageSize*(this.pearlMargin+this.pearlWidth))&&(this.pearlMargin=e/this.pageSize-this.pearlWidth),this.checkValidity(),this.isPearlSizeValid=!0)}checkValidity(){(isNaN(this.pageSize)||this.pageSize<1)&&(this.pageSize=1),isNaN(this.pearlMargin)&&(this.pearlMargin=this.DZ_PEARL_MARGIN)}invalidatePearlsSize(){this.isPearlSizeValid=!1}getpageSize(){return this.computePearlsMeasures(),this.pageSize}getPageScrollSize(){return this.pearlMargin+this.pearlWidth}layoutPearls(e){var t=this.dropzoneScrollingNode.getCurrentPageIndex(),i=this.dropzoneScrollingNode.getDropzoneSideBuffer();this.layoutPearlsPage(t-i,t+this.getpageSize()+i+1,e)}layoutPearlsPage(i,o,r){let n=this.pearlMargin+this.pearlWidth;this.dropzoneScrollingNode.collection.each((e,t)=>{i<=t&&t<o&&(e.disableLayout||(t=this.DZ_SIDE_MARGIN+t*n,e.setLayoutPositionAndSize({x:t,y:this.getRightY()},a.dropzoneConstant.PEARL_WIDTH,!1,!1,this.getDisableAnimation(e,t)?null:r),e.animationIfVisibleOnly=!1))})}getDisableAnimation(e,t){var i=this.dropzoneScrollingNode.$el.position(),o=e.getY()==this.getRightY()&&(e.getX()+i.left>this.dropzoneScrollingNode.$el.parent().width()||e.getX()+i.left<0),t=t+i.left>this.dropzoneScrollingNode.$el.parent().width()||t+i.left<0;return o||t&&e.animationIfVisibleOnly}getRightY(){return 16}layoutItems(e){this.layoutPearls(e)}getCurrentColumnCount(){return 0}getDefaultSquarePosition(){return new h.squareWorldGrid.SquarePosition({collectionIndex:-1,columnCount:0,part:0,section:null})}getClosestSquarePosition(e,t){var i=this.dropzoneScrollingNode.getCurrentPageIndex(),o=i+Math.floor(e/this.getPageScrollSize()),e=e-(o-i)*this.getPageScrollSize()<=.5*this.getPageScrollSize();return o<0||o>=this.getpageSize()+i||o<i?(o=-1,e=!0):o>=this.dropzoneScrollingNode.collection.size()&&(o=this.dropzoneScrollingNode.collection.size()-1,e=!1),new h.squareWorldGrid.SquarePosition({collectionIndex:o,columnCount:0,part:(e=!e)?1:0,section:null})}isUnderLastRowOfParagraph(e,t,i,o){return null}}S.DropzoneLayouter=I}});
